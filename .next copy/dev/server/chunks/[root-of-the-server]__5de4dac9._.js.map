{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Turan/OneDrive/Masa%C3%BCst%C3%BC/my-crypto-tracker/my-crypto-tracker/src/pages/api/coins/%5BcoinId%5D/details.ts"],"sourcesContent":["// pages/api/coins/[coinId]/details.ts\r\nimport { NextApiRequest, NextApiResponse } from 'next';\r\n\r\ninterface CoinGeckoCoinData {\r\n  id: string;\r\n  name: string;\r\n  symbol: string;\r\n  description: {\r\n    en: string;\r\n    tr?: string;\r\n  };\r\n  links: {\r\n    homepage?: string[];\r\n    whitepaper?: string;\r\n    blockchain_site?: string[];\r\n    official_forum_url?: string[];\r\n    subreddit_url?: string;\r\n    repos_url?: {\r\n      github?: string[];\r\n    };\r\n  };\r\n  image: {\r\n    large?: string;\r\n  };\r\n  market_data: {\r\n    current_price: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    market_cap: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    total_volume: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    high_24h: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    low_24h: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    price_change_percentage_24h: number;\r\n    price_change_percentage_7d: number;\r\n    price_change_percentage_30d: number;\r\n    ath: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    ath_date: {\r\n      usd: string;\r\n      try: string;\r\n    };\r\n    atl: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n    atl_date: {\r\n      usd: string;\r\n      try: string;\r\n    };\r\n    circulating_supply: number;\r\n    total_supply: number;\r\n    max_supply: number;\r\n    market_cap_rank: number;\r\n    fully_diluted_valuation: {\r\n      usd: number;\r\n      try: number;\r\n    };\r\n  };\r\n  categories?: string[];\r\n  platforms?: Record<string, string>;\r\n}\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  const { coinId } = req.query;\r\n\r\n  if (!coinId || typeof coinId !== 'string') {\r\n    return res.status(400).json({ error: 'Coin ID gerekli' });\r\n  }\r\n\r\n  try {\r\n    // Timeout için AbortController kullan\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 15000);\r\n\r\n    // CoinGecko Coin Details API'den veri çek\r\n    const response = await fetch(\r\n      `https://api.coingecko.com/api/v3/coins/${coinId}?localization=false&tickers=false&market_data=true&community_data=true&developer_data=true&sparkline=false`,\r\n      {\r\n        headers: {\r\n          'Accept': 'application/json',\r\n          'User-Agent': 'Mozilla/5.0',\r\n        },\r\n        signal: controller.signal,\r\n      }\r\n    );\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    if (!response.ok) {\r\n      console.error(`CoinGecko Details API hatası: ${response.status} ${response.statusText}`);\r\n      return res.status(200).json({\r\n        error: `API hatası: ${response.status}`,\r\n        coinId,\r\n      });\r\n    }\r\n\r\n    const data: CoinGeckoCoinData = await response.json();\r\n\r\n    // Veriyi işle ve döndür\r\n    const coinDetails = {\r\n      id: data.id,\r\n      name: data.name,\r\n      symbol: data.symbol.toUpperCase(),\r\n      description: data.description?.tr || data.description?.en || '',\r\n      image: data.image?.large || null,\r\n      \r\n      // Fiyatlar\r\n      prices: {\r\n        usd: data.market_data?.current_price?.usd || 0,\r\n        try: data.market_data?.current_price?.try || 0,\r\n      },\r\n      \r\n      // 24 saatlik aralık\r\n      priceRange24h: {\r\n        high: {\r\n          usd: data.market_data?.high_24h?.usd || 0,\r\n          try: data.market_data?.high_24h?.try || 0,\r\n        },\r\n        low: {\r\n          usd: data.market_data?.low_24h?.usd || 0,\r\n          try: data.market_data?.low_24h?.try || 0,\r\n        },\r\n      },\r\n      \r\n      // 7 günlük aralık (tahmini - CoinGecko'da direkt yok, chart'tan hesaplanabilir)\r\n      priceRange7d: {\r\n        high: 0, // Chart API'den gelecek\r\n        low: 0, // Chart API'den gelecek\r\n      },\r\n      \r\n      // All-time high/low\r\n      ath: {\r\n        price: {\r\n          usd: data.market_data?.ath?.usd || 0,\r\n          try: data.market_data?.ath?.try || 0,\r\n        },\r\n        date: data.market_data?.ath_date?.usd || null,\r\n      },\r\n      atl: {\r\n        price: {\r\n          usd: data.market_data?.atl?.usd || 0,\r\n          try: data.market_data?.atl?.try || 0,\r\n        },\r\n        date: data.market_data?.atl_date?.usd || null,\r\n      },\r\n      \r\n      // Yüzdelik değişimler\r\n      priceChanges: {\r\n        '24h': data.market_data?.price_change_percentage_24h || 0,\r\n        '7d': data.market_data?.price_change_percentage_7d || 0,\r\n        '30d': data.market_data?.price_change_percentage_30d || 0,\r\n      },\r\n      \r\n      // Piyasa verileri\r\n      marketData: {\r\n        marketCap: {\r\n          usd: data.market_data?.market_cap?.usd || 0,\r\n          try: data.market_data?.market_cap?.try || 0,\r\n        },\r\n        volume24h: {\r\n          usd: data.market_data?.total_volume?.usd || 0,\r\n          try: data.market_data?.total_volume?.try || 0,\r\n        },\r\n        fullyDilutedValuation: {\r\n          usd: data.market_data?.fully_diluted_valuation?.usd || 0,\r\n          try: data.market_data?.fully_diluted_valuation?.try || 0,\r\n        },\r\n        marketCapRank: data.market_data?.market_cap_rank || null,\r\n      },\r\n      \r\n      // Arz bilgileri\r\n      supply: {\r\n        circulating: data.market_data?.circulating_supply || 0,\r\n        total: data.market_data?.total_supply || 0,\r\n        max: data.market_data?.max_supply || 0,\r\n      },\r\n      \r\n      // Linkler\r\n      links: {\r\n        homepage: data.links?.homepage?.[0] || null,\r\n        whitepaper: data.links?.whitepaper || null,\r\n        blockchainExplorers: data.links?.blockchain_site || [],\r\n        officialForum: data.links?.official_forum_url || [],\r\n        subreddit: data.links?.subreddit_url || null,\r\n        github: data.links?.repos_url?.github?.[0] || null,\r\n      },\r\n      \r\n      // Kategoriler\r\n      categories: data.categories || [],\r\n      \r\n      // Platformlar (blockchain)\r\n      platforms: data.platforms || {},\r\n    };\r\n\r\n    res.status(200).json(coinDetails);\r\n  } catch (error) {\r\n    console.error('Coin Details API Error:', error);\r\n    \r\n    // Hata durumunda bile 200 döndür (frontend'in çökmesini önlemek için)\r\n    res.status(200).json({\r\n      error: 'CoinGecko API\\'den detaylı veri çekilemedi.',\r\n      details: error instanceof Error ? error.message : 'Bilinmeyen hata',\r\n      coinId,\r\n    });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}