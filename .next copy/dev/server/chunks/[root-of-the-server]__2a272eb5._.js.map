{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Turan/OneDrive/Masa%C3%BCst%C3%BC/my-crypto-tracker/my-crypto-tracker/src/pages/api/global.ts"],"sourcesContent":["// pages/api/global.ts\r\n// CoinGecko Global Market Data API\r\n\r\nimport { NextApiRequest, NextApiResponse } from 'next';\r\n\r\ninterface CoinGeckoGlobalData {\r\n  data: {\r\n    active_cryptocurrencies: number;\r\n    upcoming_icos: number;\r\n    ongoing_icos: number;\r\n    ended_icos: number;\r\n    markets: number;\r\n    total_market_cap: Record<string, number>;\r\n    total_volume: Record<string, number>;\r\n    market_cap_percentage: Record<string, number>;\r\n    market_cap_change_percentage_24h_usd: number;\r\n    updated_at: number;\r\n  };\r\n}\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  try {\r\n    // Timeout için AbortController kullan\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 saniye timeout\r\n\r\n    // CoinGecko Global API'den veri çek\r\n    const response = await fetch('https://api.coingecko.com/api/v3/global', {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'User-Agent': 'Mozilla/5.0',\r\n      },\r\n      signal: controller.signal,\r\n    });\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    if (!response.ok) {\r\n      console.error(`CoinGecko API hatası: ${response.status} ${response.statusText}`);\r\n      // Hata durumunda fallback değerler döndür\r\n      return res.status(200).json({\r\n        totalCoins: 0,\r\n        totalExchanges: 0,\r\n        marketCap: 0,\r\n        marketCapChange24h: 0,\r\n        volume24h: 0,\r\n        btcDominance: 0,\r\n        ethDominance: 0,\r\n        updatedAt: Date.now(),\r\n        error: `API hatası: ${response.status}`,\r\n      });\r\n    }\r\n\r\n    const data: CoinGeckoGlobalData = await response.json();\r\n\r\n    // Veri yapısını kontrol et\r\n    if (!data || !data.data) {\r\n      console.error('Geçersiz API yanıtı:', data);\r\n      return res.status(200).json({\r\n        totalCoins: 0,\r\n        totalExchanges: 0,\r\n        marketCap: 0,\r\n        marketCapChange24h: 0,\r\n        volume24h: 0,\r\n        btcDominance: 0,\r\n        ethDominance: 0,\r\n        updatedAt: Date.now(),\r\n        error: 'Geçersiz API yanıtı',\r\n      });\r\n    }\r\n\r\n    // Veriyi işle ve döndür\r\n    const globalData = data.data;\r\n    \r\n    res.status(200).json({\r\n      totalCoins: globalData.active_cryptocurrencies || 0,\r\n      totalExchanges: globalData.markets || 0,\r\n      marketCap: globalData.total_market_cap?.usd || 0,\r\n      marketCapChange24h: globalData.market_cap_change_percentage_24h_usd || 0,\r\n      volume24h: globalData.total_volume?.usd || 0,\r\n      btcDominance: globalData.market_cap_percentage?.btc || 0,\r\n      ethDominance: globalData.market_cap_percentage?.eth || 0,\r\n      updatedAt: globalData.updated_at || Date.now(),\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Global API Error:', error);\r\n    \r\n    // Hata durumunda bile 200 döndür (frontend'in çökmesini önlemek için)\r\n    // Frontend'de error kontrolü yapılacak\r\n    res.status(200).json({ \r\n      totalCoins: 0,\r\n      totalExchanges: 0,\r\n      marketCap: 0,\r\n      marketCapChange24h: 0,\r\n      volume24h: 0,\r\n      btcDominance: 0,\r\n      ethDominance: 0,\r\n      updatedAt: Date.now(),\r\n      error: 'CoinGecko API\\'den veri çekilemedi.',\r\n      details: error instanceof Error ? error.message : 'Bilinmeyen hata'\r\n    });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA,sBAAsB;AACtB,mCAAmC;;;;;AAmBpB,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI;QACF,sCAAsC;QACtC,MAAM,aAAa,IAAI;QACvB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI,QAAQ,oBAAoB;QAEnF,oCAAoC;QACpC,MAAM,WAAW,MAAM,MAAM,2CAA2C;YACtE,SAAS;gBACP,UAAU;gBACV,cAAc;YAChB;YACA,QAAQ,WAAW,MAAM;QAC3B;QAEA,aAAa;QAEb,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;YAC/E,0CAA0C;YAC1C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,YAAY;gBACZ,gBAAgB;gBAChB,WAAW;gBACX,oBAAoB;gBACpB,WAAW;gBACX,cAAc;gBACd,cAAc;gBACd,WAAW,KAAK,GAAG;gBACnB,OAAO,CAAC,YAAY,EAAE,SAAS,MAAM,EAAE;YACzC;QACF;QAEA,MAAM,OAA4B,MAAM,SAAS,IAAI;QAErD,2BAA2B;QAC3B,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE;YACvB,QAAQ,KAAK,CAAC,wBAAwB;YACtC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,YAAY;gBACZ,gBAAgB;gBAChB,WAAW;gBACX,oBAAoB;gBACpB,WAAW;gBACX,cAAc;gBACd,cAAc;gBACd,WAAW,KAAK,GAAG;gBACnB,OAAO;YACT;QACF;QAEA,wBAAwB;QACxB,MAAM,aAAa,KAAK,IAAI;QAE5B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB,YAAY,WAAW,uBAAuB,IAAI;YAClD,gBAAgB,WAAW,OAAO,IAAI;YACtC,WAAW,WAAW,gBAAgB,EAAE,OAAO;YAC/C,oBAAoB,WAAW,oCAAoC,IAAI;YACvE,WAAW,WAAW,YAAY,EAAE,OAAO;YAC3C,cAAc,WAAW,qBAAqB,EAAE,OAAO;YACvD,cAAc,WAAW,qBAAqB,EAAE,OAAO;YACvD,WAAW,WAAW,UAAU,IAAI,KAAK,GAAG;QAC9C;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QAEnC,sEAAsE;QACtE,uCAAuC;QACvC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB,YAAY;YACZ,gBAAgB;YAChB,WAAW;YACX,oBAAoB;YACpB,WAAW;YACX,cAAc;YACd,cAAc;YACd,WAAW,KAAK,GAAG;YACnB,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACF;AACF"}}]
}