{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Turan/OneDrive/Masa%C3%BCst%C3%BC/my-crypto-tracker/my-crypto-tracker/src/pages/api/auth/register.ts"],"sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next';\r\nimport { Pool } from 'pg';\r\nimport bcrypt from 'bcrypt';\r\n\r\n// Veritabanı bağlantısı\r\nconst pool = new Pool({\r\n  user: process.env.POSTGRES_USER,\r\n  host: process.env.POSTGRES_HOST,\r\n  database: process.env.POSTGRES_DATABASE,\r\n  password: process.env.POSTGRES_PASSWORD,\r\n  port: parseInt(process.env.POSTGRES_PORT || '5432'),\r\n});\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  // Sadece POST isteklerine izin ver\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ message: 'Method not allowed' });\r\n  }\r\n\r\n  const { email, password, fullName } = req.body;\r\n\r\n  try {\r\n    // 1. Kullanıcı zaten var mı kontrol et\r\n    const userCheck = await pool.query('SELECT * FROM users WHERE email = $1', [email]);\r\n    if (userCheck.rows.length > 0) {\r\n      return res.status(400).json({ message: 'Bu e-posta adresi zaten kullanılıyor.' });\r\n    }\r\n\r\n    // 2. Şifreyi şifrele (Hashleme)\r\n    const saltRounds = 10;\r\n    const passwordHash = await bcrypt.hash(password, saltRounds);\r\n\r\n    // 3. Yeni kullanıcıyı veritabanına ekle\r\n    const newUser = await pool.query(\r\n      'INSERT INTO users (email, password_hash, full_name) VALUES ($1, $2, $3) RETURNING id, email, full_name',\r\n      [email, passwordHash, fullName]\r\n    );\r\n\r\n    // Başarılı cevap dön\r\n    res.status(201).json({ message: 'Kayıt başarılı!', user: newUser.rows[0] });\r\n\r\n  } catch (error) {\r\n    console.error('Register hatası:', error);\r\n    res.status(500).json({ message: 'Sunucu hatası oluştu.' });\r\n  }\r\n}"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;AAEA,wBAAwB;AACxB,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,aAAa;IAC/B,MAAM,QAAQ,GAAG,CAAC,aAAa;IAC/B,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IACvC,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IACvC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI;AAC9C;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,mCAAmC;IACnC,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC9D;IAEA,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAE9C,IAAI;QACF,uCAAuC;QACvC,MAAM,YAAY,MAAM,KAAK,KAAK,CAAC,wCAAwC;YAAC;SAAM;QAClF,IAAI,UAAU,IAAI,CAAC,MAAM,GAAG,GAAG;YAC7B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAAwC;QACjF;QAEA,gCAAgC;QAChC,MAAM,aAAa;QACnB,MAAM,eAAe,MAAM,gHAAM,CAAC,IAAI,CAAC,UAAU;QAEjD,wCAAwC;QACxC,MAAM,UAAU,MAAM,KAAK,KAAK,CAC9B,0GACA;YAAC;YAAO;YAAc;SAAS;QAGjC,qBAAqB;QACrB,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAmB,MAAM,QAAQ,IAAI,CAAC,EAAE;QAAC;IAE3E,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAwB;IAC1D;AACF"}}]
}