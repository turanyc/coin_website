{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Turan/OneDrive/Masa%C3%BCst%C3%BC/my-crypto-tracker/my-crypto-tracker/src/pages/api/auth/login.ts"],"sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next';\r\nimport { Pool } from 'pg';\r\nimport bcrypt from 'bcrypt';\r\n\r\nconst pool = new Pool({\r\n  user: process.env.POSTGRES_USER,\r\n  host: process.env.POSTGRES_HOST,\r\n  database: process.env.POSTGRES_DATABASE,\r\n  password: process.env.POSTGRES_PASSWORD,\r\n  port: parseInt(process.env.POSTGRES_PORT || '5432'),\r\n});\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ message: 'Method not allowed' });\r\n  }\r\n\r\n  const { email, password } = req.body;\r\n\r\n  try {\r\n    // 1. Kullanıcıyı e-posta ile bul\r\n    const result = await pool.query('SELECT * FROM users WHERE email = $1', [email]);\r\n    \r\n    // Kullanıcı yoksa hata ver\r\n    if (result.rows.length === 0) {\r\n      return res.status(401).json({ message: 'E-posta veya şifre hatalı.' });\r\n    }\r\n\r\n    const user = result.rows[0];\r\n\r\n    // 2. Girilen şifre ile veritabanındaki şifreli şifreyi karşılaştır\r\n    const match = await bcrypt.compare(password, user.password_hash);\r\n\r\n    if (!match) {\r\n      return res.status(401).json({ message: 'E-posta veya şifre hatalı.' });\r\n    }\r\n\r\n    // 3. Giriş başarılı\r\n    res.status(200).json({ message: 'Giriş başarılı!', user: { id: user.id, email: user.email, name: user.full_name } });\r\n\r\n  } catch (error) {\r\n    console.error('Login hatası:', error);\r\n    res.status(500).json({ message: 'Sunucu hatası oluştu.' });\r\n  }\r\n}"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,aAAa;IAC/B,MAAM,QAAQ,GAAG,CAAC,aAAa;IAC/B,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IACvC,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IACvC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI;AAC9C;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC9D;IAEA,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAEpC,IAAI;QACF,iCAAiC;QACjC,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,wCAAwC;YAAC;SAAM;QAE/E,2BAA2B;QAC3B,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAA6B;QACtE;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAE3B,mEAAmE;QACnE,MAAM,QAAQ,MAAM,gHAAM,CAAC,OAAO,CAAC,UAAU,KAAK,aAAa;QAE/D,IAAI,CAAC,OAAO;YACV,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAA6B;QACtE;QAEA,oBAAoB;QACpB,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAmB,MAAM;gBAAE,IAAI,KAAK,EAAE;gBAAE,OAAO,KAAK,KAAK;gBAAE,MAAM,KAAK,SAAS;YAAC;QAAE;IAEpH,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAwB;IAC1D;AACF"}}]
}