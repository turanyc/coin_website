{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Turan/OneDrive/Masa%C3%BCst%C3%BC/my-crypto-tracker/my-crypto-tracker/src/pages/api/coins.ts"],"sourcesContent":["// pages/api/coins.ts\r\n\r\nimport { NextApiRequest, NextApiResponse } from 'next';\r\nimport { Pool } from 'pg'; \r\n\r\n// ðŸš¨ BaÄŸlantÄ± bilgileriniz\r\nconst pool = new Pool({\r\n  user: process.env.POSTGRES_USER,\r\n  host: process.env.POSTGRES_HOST,\r\n  database: process.env.POSTGRES_DATABASE,\r\n  password: process.env.POSTGRES_PASSWORD,\r\n  port: parseInt(process.env.POSTGRES_PORT || '5432'),\r\n});\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  try {\r\n    // Piyasa DeÄŸerine gÃ¶re sÄ±ralanmÄ±ÅŸ ilk 100 coin'i Ã§ek (duplicate Ã¶nlemek iÃ§in)\r\n    const result = await pool.query(\r\n      `SELECT \r\n        id, name, symbol, current_price, price_change_percentage_24h, \r\n        market_cap, total_volume, image \r\n      FROM (\r\n        SELECT \r\n          id, name, symbol, current_price, price_change_percentage_24h, \r\n          market_cap, total_volume, image,\r\n          ROW_NUMBER() OVER (PARTITION BY LOWER(TRIM(id)) ORDER BY market_cap DESC, last_updated DESC NULLS LAST) as rn\r\n        FROM coins\r\n      ) AS ranked_coins\r\n      WHERE rn = 1\r\n      ORDER BY market_cap DESC \r\n      LIMIT 100`\r\n    );\r\n    \r\n    // Veriyi parse et ve hazÄ±rla\r\n    const parsedRows = result.rows.map(row => ({\r\n      ...row,\r\n      image: row.image || null,\r\n      current_price: parseFloat(row.current_price) || 0,\r\n      price_change_percentage_24h: parseFloat(row.price_change_percentage_24h) || 0,\r\n      market_cap: parseFloat(row.market_cap) || 0,\r\n      total_volume: parseFloat(row.total_volume) || 0,\r\n    }));\r\n    \r\n    // Duplicate'leri filtrele - Ã¶nce ID bazlÄ±, sonra symbol bazlÄ±\r\n    const seenIds = new Map<string, typeof parsedRows[0]>();\r\n    \r\n    // Ä°lk adÄ±m: ID bazlÄ± duplicate'leri filtrele\r\n    parsedRows.forEach(row => {\r\n      const normalizedId = row.id.toLowerCase().trim();\r\n      if (!seenIds.has(normalizedId)) {\r\n        seenIds.set(normalizedId, row);\r\n      } else {\r\n        const existing = seenIds.get(normalizedId)!;\r\n        if (row.market_cap > existing.market_cap) {\r\n          seenIds.set(normalizedId, row);\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Ä°kinci adÄ±m: Symbol bazlÄ± duplicate'leri filtrele (BTC iÃ§in Bitcoin gibi)\r\n    const seenSymbols = new Map<string, typeof parsedRows[0]>();\r\n    Array.from(seenIds.values()).forEach(row => {\r\n      const normalizedSymbol = row.symbol.toLowerCase().trim();\r\n      if (!seenSymbols.has(normalizedSymbol)) {\r\n        seenSymbols.set(normalizedSymbol, row);\r\n      } else {\r\n        const existing = seenSymbols.get(normalizedSymbol)!;\r\n        if (row.market_cap > existing.market_cap) {\r\n          seenSymbols.set(normalizedSymbol, row);\r\n        }\r\n      }\r\n    });\r\n    \r\n    const uniqueRows = Array.from(seenSymbols.values()).sort((a, b) => b.market_cap - a.market_cap);\r\n    \r\n    // Veriyi JSON olarak dÃ¶ndÃ¼r\r\n    res.status(200).json(uniqueRows);\r\n\r\n  } catch (error) {\r\n    console.error('API Error:', error);\r\n    res.status(500).json({ error: 'VeritabanÄ±ndan veri Ã§ekilemedi.' });\r\n  }\r\n}"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AAGrB;;;;;;AAEA,2BAA2B;AAC3B,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,aAAa;IAC/B,MAAM,QAAQ,GAAG,CAAC,aAAa;IAC/B,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IACvC,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IACvC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI;AAC9C;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI;QACF,8EAA8E;QAC9E,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,CAAC;;;;;;;;;;;;eAYQ,CAAC;QAGZ,6BAA6B;QAC7B,MAAM,aAAa,OAAO,IAAI,CAAC,GAAG,CAAC,CAAA,MAAO,CAAC;gBACzC,GAAG,GAAG;gBACN,OAAO,IAAI,KAAK,IAAI;gBACpB,eAAe,WAAW,IAAI,aAAa,KAAK;gBAChD,6BAA6B,WAAW,IAAI,2BAA2B,KAAK;gBAC5E,YAAY,WAAW,IAAI,UAAU,KAAK;gBAC1C,cAAc,WAAW,IAAI,YAAY,KAAK;YAChD,CAAC;QAED,8DAA8D;QAC9D,MAAM,UAAU,IAAI;QAEpB,6CAA6C;QAC7C,WAAW,OAAO,CAAC,CAAA;YACjB,MAAM,eAAe,IAAI,EAAE,CAAC,WAAW,GAAG,IAAI;YAC9C,IAAI,CAAC,QAAQ,GAAG,CAAC,eAAe;gBAC9B,QAAQ,GAAG,CAAC,cAAc;YAC5B,OAAO;gBACL,MAAM,WAAW,QAAQ,GAAG,CAAC;gBAC7B,IAAI,IAAI,UAAU,GAAG,SAAS,UAAU,EAAE;oBACxC,QAAQ,GAAG,CAAC,cAAc;gBAC5B;YACF;QACF;QAEA,4EAA4E;QAC5E,MAAM,cAAc,IAAI;QACxB,MAAM,IAAI,CAAC,QAAQ,MAAM,IAAI,OAAO,CAAC,CAAA;YACnC,MAAM,mBAAmB,IAAI,MAAM,CAAC,WAAW,GAAG,IAAI;YACtD,IAAI,CAAC,YAAY,GAAG,CAAC,mBAAmB;gBACtC,YAAY,GAAG,CAAC,kBAAkB;YACpC,OAAO;gBACL,MAAM,WAAW,YAAY,GAAG,CAAC;gBACjC,IAAI,IAAI,UAAU,GAAG,SAAS,UAAU,EAAE;oBACxC,YAAY,GAAG,CAAC,kBAAkB;gBACpC;YACF;QACF;QAEA,MAAM,aAAa,MAAM,IAAI,CAAC,YAAY,MAAM,IAAI,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,UAAU,GAAG,EAAE,UAAU;QAE9F,4BAA4B;QAC5B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAEvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAkC;IAClE;AACF"}}]
}