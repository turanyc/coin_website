{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Turan/OneDrive/Masa%C3%BCst%C3%BC/my-crypto-tracker/my-crypto-tracker/src/pages/api/fear-greed.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\n\r\ninterface FearGreedResponse {\r\n  name: string;\r\n  data: Array<{\r\n    value: string;\r\n    value_classification: string;\r\n    timestamp: string;\r\n    time_until_update?: string;\r\n  }>;\r\n  metadata: {\r\n    error?: string;\r\n  };\r\n}\r\n\r\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 dakika\r\nlet cache: { data: any; timestamp: number } | null = null;\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  // Cache kontrolü\r\n  if (cache && Date.now() - cache.timestamp < CACHE_DURATION) {\r\n    return res.status(200).json(cache.data);\r\n  }\r\n\r\n  try {\r\n    // Alternative.me Fear & Greed Index API'den veri çek\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 10000);\r\n\r\n    const response = await fetch('https://api.alternative.me/fng/', {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'User-Agent': 'Mozilla/5.0',\r\n      },\r\n      signal: controller.signal,\r\n    });\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    if (!response.ok) {\r\n      console.error(`Fear & Greed API hatası: ${response.status}`);\r\n      \r\n      // Cache'den eski veri varsa onu döndür\r\n      if (cache) {\r\n        return res.status(200).json({\r\n          ...cache.data,\r\n          warning: 'API hatası, önbellekten veri gösteriliyor',\r\n        });\r\n      }\r\n\r\n      return res.status(200).json({\r\n        value: 50,\r\n        classification: 'Neutral',\r\n        error: `API hatası: ${response.status}`,\r\n      });\r\n    }\r\n\r\n    const data: FearGreedResponse = await response.json();\r\n\r\n    if (!data || !data.data || !Array.isArray(data.data) || data.data.length === 0) {\r\n      console.error('Geçersiz Fear & Greed API yanıtı:', data);\r\n      \r\n      if (cache) {\r\n        return res.status(200).json({\r\n          ...cache.data,\r\n          warning: 'Geçersiz API yanıtı, önbellekten veri gösteriliyor',\r\n        });\r\n      }\r\n\r\n      return res.status(200).json({\r\n        value: 50,\r\n        classification: 'Neutral',\r\n        error: 'Geçersiz API yanıtı',\r\n      });\r\n    }\r\n\r\n    const latestData = data.data[0];\r\n    const value = parseInt(latestData.value, 10);\r\n    const classification = latestData.value_classification;\r\n\r\n    const result = {\r\n      value: isNaN(value) ? 50 : value,\r\n      classification: classification || 'Neutral',\r\n      timestamp: latestData.timestamp,\r\n    };\r\n\r\n    // Cache'e kaydet\r\n    cache = {\r\n      data: result,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    res.status(200).json(result);\r\n  } catch (error) {\r\n    console.error('Fear & Greed API Error:', error);\r\n\r\n    // Cache'den eski veri varsa onu döndür\r\n    if (cache) {\r\n      return res.status(200).json({\r\n        ...cache.data,\r\n        warning: 'API hatası, önbellekten veri gösteriliyor',\r\n      });\r\n    }\r\n\r\n    res.status(200).json({\r\n      value: 50,\r\n      classification: 'Neutral',\r\n      error: 'API\\'den veri çekilemedi.',\r\n      details: error instanceof Error ? error.message : 'Bilinmeyen hata',\r\n    });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAeA,MAAM,iBAAiB,IAAI,KAAK,MAAM,WAAW;AACjD,IAAI,QAAiD;AAEtC,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,iBAAiB;IACjB,IAAI,SAAS,KAAK,GAAG,KAAK,MAAM,SAAS,GAAG,gBAAgB;QAC1D,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC,MAAM,IAAI;IACxC;IAEA,IAAI;QACF,qDAAqD;QACrD,MAAM,aAAa,IAAI;QACvB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI;QAEvD,MAAM,WAAW,MAAM,MAAM,mCAAmC;YAC9D,SAAS;gBACP,UAAU;gBACV,cAAc;YAChB;YACA,QAAQ,WAAW,MAAM;QAC3B;QAEA,aAAa;QAEb,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,CAAC,yBAAyB,EAAE,SAAS,MAAM,EAAE;YAE3D,uCAAuC;YACvC,IAAI,OAAO;gBACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAC1B,GAAG,MAAM,IAAI;oBACb,SAAS;gBACX;YACF;YAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,OAAO;gBACP,gBAAgB;gBAChB,OAAO,CAAC,YAAY,EAAE,SAAS,MAAM,EAAE;YACzC;QACF;QAEA,MAAM,OAA0B,MAAM,SAAS,IAAI;QAEnD,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM,OAAO,CAAC,KAAK,IAAI,KAAK,KAAK,IAAI,CAAC,MAAM,KAAK,GAAG;YAC9E,QAAQ,KAAK,CAAC,qCAAqC;YAEnD,IAAI,OAAO;gBACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAC1B,GAAG,MAAM,IAAI;oBACb,SAAS;gBACX;YACF;YAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,OAAO;gBACP,gBAAgB;gBAChB,OAAO;YACT;QACF;QAEA,MAAM,aAAa,KAAK,IAAI,CAAC,EAAE;QAC/B,MAAM,QAAQ,SAAS,WAAW,KAAK,EAAE;QACzC,MAAM,iBAAiB,WAAW,oBAAoB;QAEtD,MAAM,SAAS;YACb,OAAO,MAAM,SAAS,KAAK;YAC3B,gBAAgB,kBAAkB;YAClC,WAAW,WAAW,SAAS;QACjC;QAEA,iBAAiB;QACjB,QAAQ;YACN,MAAM;YACN,WAAW,KAAK,GAAG;QACrB;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QAEzC,uCAAuC;QACvC,IAAI,OAAO;YACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,GAAG,MAAM,IAAI;gBACb,SAAS;YACX;QACF;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB,OAAO;YACP,gBAAgB;YAChB,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACF;AACF"}}]
}